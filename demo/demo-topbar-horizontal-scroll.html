<html>
	<head>
		<title>call events demo</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
			<style>
				.mobile-wrapper {
					position: relative;
					width: 375px;
					height: 812px;
					background-color: #444;
				}
				.mobile-statusbar {
					background-image: url("image-mobile-statusbar@2x.png");
					background-size: contain;
					width: 375px;
					height: 90px;
				}
				.mobile-navbar {
					background-image: url("image-mobile-navbar@2x.png");
					background-size: contain;
					position: absolute;
					bottom: 0;
					width: 375px;
					height: 83px;
				}
				#call-container {
					background-color: #f0f0f0;
					width: 375px;
				}
				h4 {
					margin: 0;
				}
				#call-frame {
					width: 100%;
					height: 128px;
					border: 0;
					padding: 20px 0;
				}
				#header, #controller {
					padding: 14px 20px;
					display: flex;
			    flex-direction: row;
			    align-items: center;
			    justify-content: space-between;
					background-color: #f0f0f0;
				}
				#controller ul {
					margin: 0;
					padding: 0;
				}
				#controller ul li img {
					filter: invert(100%);
				}
				#controller #leave p {
					color: #ff3b30;
					text-align: right;
					font-family: "Helvetica", Arial, sans-serif;
					font-size: 12px;
					font-weight: 800;
					cursor: pointer;
				}
				.controller-item {
					list-style-type: none;
			    display: inline-block;
					cursor: pointer;
				}
				.controller-item img {
					width: 24px;
					height: 24px;
				}
				.controller-item:nth-child(n+2) {
					margin-left: 10px;
				}
				#message-incall {
					display: none;
				}
				#message-joining {
					display: block;
				}
				#message-exit {
					display: none;
					cursor: pointer;
				}
				/* smartphones, touchscreens */
				@media (hover: none) and (pointer: coarse) {
					.mobile-wrapper {
						width: 100%;
						height: 100%;
					}
					.mobile-statusbar, .mobile-navbar {
						display: none;
					}
					#call-container {
						width: 100%;
						overflow-x: scroll;
						-webkit-overflow-scrolling: touch;
					}
				}
			</style>
	</head>
	<body>
		<script>
			let url, token;
			function showEvent(e) {
			  console.log('PARENT FRAME GOT EVENT -->', e);
			}
			function exitCall() {
				document.getElementById('message-exit').style.display = "block";
				document.getElementById('message-incall').style.display = "none";
			}
			async function updateEvent() {
				let ps = callFrame.participants();
				if (Object.keys(ps).length < 2) {
					document.getElementById('message-incall').style.display = "block";
					document.getElementById('message-joining').style.display = "none";
					document.getElementById('message-exit').style.display = "none";
				}	else {
					document.getElementById('message-joining').style.display = "none";
					}
				}
			async function run() {
			  // from demo/.env, get a Daily.co meeting url and a meeting token
			  // that allows screen sharing and recording
			  let res = await fetch('/env');
			  config = await res.json();
			  console.log('CONFIG', config);
			  url = config.DEMO_MEETING_URL;
			  token = config.DEMO_MEETING_TOKEN;
			  window.callFrame = window.DailyIframe.wrap(
			    document.getElementById('call-frame'),
			    { layout: 'custom-v1' }
			  );
			  callFrame.on('joining-meeting', showEvent)
			           .on('joined-meeting', showEvent)
			           .on('left-meeting', updateEvent)
			           .on('participant-joined', updateEvent)
			           .on('participant-updated', updateEvent)
			           .on('participant-left', updateEvent)
			           .on('recording-started', showEvent)
			           .on('recording-stopped', showEvent)
			           .on('recording-stats', showEvent)
			           .on('recording-error', showEvent)
			           .on('recording-upload-completed', showEvent)
			           .on('error', showEvent);
			  callFrame.join({
			    url,
			    token,
			    cssFile: 'demo-topbar-horizontal-scroll.css'
			  });
			}
		</script>
		<div class="mobile-wrapper">
			<div class="mobile-statusbar"></div>
			<div id="header">
				<h4 id="message-incall">You're in a call</h4>
				<h4 id="message-joining">Joining callâ€¦</h4>
				<h4 id="message-exit" onclick="callFrame.join({ url }).then((ps)=>console.log('joined and have participants', ps));">You've exited, click to rejoin</h4>
			</div>
			<div id="call-container">
				<iframe id="call-frame" allow="camera; microphone; autoplay"></iframe>
			</div>
			<div id="controller">
				<ul>
					<li class="controller-item" onclick="callFrame.setLocalAudio(!callFrame.localAudio())">
						<img src="/demo/icon-microphone.svg" />
					</li>
					<li class="controller-item" onclick="callFrame.setLocalVideo(!callFrame.localVideo())">
						<img src="/demo/icon-camera.svg" />
					</li>
				</ul>
				<div onclick="callFrame.leave().then(()=>console.log('LEAVE PROMISE RESOLVED'));exitCall()" id="leave">
					<p>Leave call</p>
				</div>
			</div>
			<div class="mobile-navbar"></div>
		</div>
		<script src="../dist/daily-iframe.js" onload="run()"></script>
	</body>
</html>
