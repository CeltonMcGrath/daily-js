<html>
  <head>
    <title>call events demo</title>
  </head>
  <body>
    <script>
      let url = 'http://localhost:8000/hello?cdmn=kwindla';
    </script>

    <div
      onclick="callFrame.join({ url }).then((ps)=>console.log('joined and have participants', ps));"
    >
      [ join mtg ]
    </div>
    <div onclick="console.log('PARTICIPANTS', callFrame.participants())">
      [ get participants ]
    </div>
    <div
      onclick="callFrame.leave().then(()=>console.log('LEAVE PROMISE RESOLVED'))"
    >
      [ leave mtg ]
    </div>
    <div onclick="callFrame.setLocalVideo(!callFrame.localVideo())">
      [ toggle local cam state ]
    </div>
    <div onclick="callFrame.setLocalAudio(!callFrame.localAudio())">
      [ toggle local mic state ]
    </div>
    <div onclick="callFrame.startScreenShare()">
      [ start screen share ]
    </div>
    <div onclick="callFrame.stopScreenShare()">
      [ stop screen share ]
    </div>

    <div>&nbsp;</div>

    <div
      onclick="callFrame.updateParticipant(firstNonlocalId(),{setVideo:false})"
    >
      [ mute remote cam ]
    </div>
    <div
      onclick="callFrame.updateParticipant(firstNonlocalId(),{setVideo:true})"
    >
      [ unmute remote cam ]
    </div>
    <div
      onclick="callFrame.updateParticipant(firstNonlocalId(),{setAudio:false})"
    >
      [ mute remote mic ]
    </div>
    <div
      onclick="callFrame.updateParticipant(firstNonlocalId(),{setAudio:true})"
    >
      [ unmute remote mic ]
    </div>
    <div onclick="callFrame.updateParticipant(firstNonlocalId(),{eject:true})">
      [ eject remote participant ]
    </div>

    <iframe
      id="call-frame"
      width="350"
      height="425"
      allow="camera; microphone; autoplay"
      style="position: absolute; right: 1em; bottom: 3em;"
    ></iframe>

    <script>
      function firstNonlocalId() {
        for (var p in callFrame.participants()) {
          if (p !== 'local') return p;
        }
      }

      function showEvent(e) {
        console.log('PARENT FRAME GOT EVENT -->', e);
      }

      function run() {
        window.callFrame = window.DailyIframe.wrap(
          document.getElementById('call-frame')
        );
        callFrame
          .on('joining-meeting', showEvent)
          .on('joined-meeting', showEvent)
          .on('left-meeting', showEvent)
          .on('participant-joined', showEvent)
          .on('participant-updated', showEvent)
          .on('participant-left', showEvent)
          .on('error', showEvent);

        console.log(callFrame);
      }
    </script>
    <script src="../dist/daily-iframe.js" onload="run()"></script>
  </body>
</html>
